!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):"object"==typeof exports?exports.Mickey=n():t.Mickey=n()}(this,function(){return function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t){function n(t){var n=function(n){var e=g[n.keyCode];"click"===e?t.click():e&&t.move(e)};return{bind:_.bind(document.addEventListener,document,"keydown",n),unbind:_.bind(document.removeEventListener,document,"keydown",n)}}function e(t,n){var e;return null!=window.MutationObserver?(e=new MutationObserver(n),e.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(n=_.debounce(n,0),t.addEventListener("DOMSubtreeModified",n),e={disconnect:function(){t.removeEventListener("DOMSubtreeModified",n)}}),e}function r(t,n){return t.querySelector(n)}function o(t,n){return _.toArray(t.querySelectorAll(n))}function i(t,n,e){t&&e!==!1&&t.classList.add(n)}function u(t,n,e){t&&e!==!1&&t.classList.remove(n)}function a(){return{x:0,y:0}}function c(t,n){return{x:n.x-t.x,y:n.y-t.y}}function s(t,n){return f(c(t,n))}function l(t,n,e){return f(y(c(t,n),e))}function f(t){return Math.abs(t.x)+Math.abs(t.y)}function d(t){return{x:-t.x,y:-t.y}}function v(t,n){return t.x*n.x+t.y*n.y}function h(t,n){return{x:2*n.x-t.x,y:2*n.y-t.y}}function p(t,n,e){return{x:t.x+2*(n.x-t.x)*Math.abs(e.x),y:t.y+2*(n.y-t.y)*Math.abs(e.y)}}function y(t,n){var e=v(t,n);return{x:e*n.x,y:e*n.y}}function b(t,n){return function(e){return null==e.dataset[t]?0:n}}function x(t){if(t){var n=t.getBoundingClientRect();return n.height>0||n.width>0?new k(t,n):void 0}}function k(t,n){this.el=t,this._r=n}function m(t,f){function y(t,n){if(t){var e=document.createEvent("MouseEvents"),r=T.pos.x,o=T.pos.y;e.initMouseEvent(n,!0,!0,window,0,r,o,r,o,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}function b(n){return!!n&&(null!=n.dataset.navArea||n===t)}function m(t){return!!t&&null!=t.dataset.navLimit}function g(t){return!!t&&null!=t.dataset.navTrack}function S(t,n){if(!t||null==t.dataset.navCircular)return!1;var e=t.dataset.navCircular;return""===e||E[n]===e}function A(t,n){return!!n&&m(t)&&t.dataset.navLimit===M[n]}function j(t){return!!t&&null!=t.dataset.navSelected}function O(t,n,e,r){var o=e?w[e]:a(),i=d(o);t instanceof k&&(t=t.bound(o));var u=function(n){return v(c(t,n),o)>=-f.overlap},h=_.map(_.filter(_.map(n,x),function(t){return t&&u(r?t.bound(i):t.center())}),function(n){return{el:n.el,proj:l(t,n.bound(i),o),dist:s(t,n.bound(i))}});return h=_.sortBy(h,function(t){return t.proj}),h.length>1&&h[0].proj===h[1].proj&&(h=_.sortBy(h,function(t){return t.dist})),h[0]&&h[0].el}function B(t,n){var e=x(O(t,n));return e&&e.contains(t)?e.el:void 0}function I(){var n=o(t,f.$area);return n.length?n:[t]}function D(){var t=I();return _.some(t,j)&&(t=_.sortBy(t,L)),_.first(t)}function $(t,n){var e=o(t,t.dataset.navArea||f.$href),r=_.some(e,m);return r&&(e=_.sortBy(e,C)),r&&n?_.filter(e,function(t){return!m(t)||A(t,n)}):e}function q(t){return T.focus(T.closest()||D(),t,!0)}if(!t)throw new Error("mickey: should pass a parent DOM element");var z=!1,N=!1;f=_.defaults(f||{},{hoverClass:"hover",areaClass:"hover",trackClass:"tracked",overlap:0,position:null,listener:n,$area:"[data-nav-area]",$href:null});var P,T={version:"1.0.0",pos:f.position||a(),el:null,ar:null},J=f.listener(T),R=_.once(function(){P=e(t,F),J.bind&&J.bind(t)}),Z=_.once(function(){P&&P.disconnect(),J.unbind&&J.unbind()});T.focus=function(n,e,r){if(_.isString(n)&&(n=t.querySelector(n)),b(n))return T.focus(T.defaults(n));var o=x(n);if(!o)return!1;var a=n,c=T.area(a),s=T.el,l=T.ar,d=m(a),v=c!==l;return v&&(T.ar=c,u(l,f.areaClass),i(c,f.areaClass)),a===s||c===l&&d&&!r||(T.pos=o.center(),T.el=a,u(s,f.hoverClass),i(s,f.trackClass,v&&g(l)),u(a,f.trackClass),i(a,f.hoverClass,!d),y(s,"mouseout"),y(a,"mouseover")),d&&A(a,e)&&T.click(n),N||(N=!0),!0},T.position=function(){return{x:T.pos.x,y:T.pos.y}},T.move=function(t){if(z)throw new Error("mickey: locked");var n=T.el,e=x(n);if(e){var o=T.area(),i=_.without($(o,t),n),u=O(e,i,t);if(u)return T.focus(u,t);var a=+o.dataset.navZIndex;if(!(a>0)){if(S(o,t))return T.focus(T.circular(t));var c=x(o),s=_.without(I(),o),l=O(c,s,t,!0);if(!l)return A(T.el,t)?T.click():!1;var d=$(l);if(1===d.length&&A(d[0],t))return T.click(d[0]);if(g(o)&&(o.dataset.navTrackPos=JSON.stringify(T.pos)),g(l)){var v=l.dataset.navTrackPos,h=r(l,"."+f.trackClass);u=h||v&&O(JSON.parse(v),d)}return T.focus(u||d[0],t)}}else if(!q(t))throw new Error("mickey: cannot move")},T.click=function(n){if(z||!N)throw new Error("mickey: locked");if(n=n||T.el,!t.contains(n))throw new Error("mickey: cannot click on non visible element");if(!n&&!q())throw new Error("mickey: cannot click");return y(n,"click"),!0},T.area=function(n){for(n=n||T.el;n&&n!==t;)if(n=n.parentNode,b(n))return n;return t},T.closest=function(t){var n=_.flatten(_.map(t?[t]:I(),$));return O(T.pos,n)},T.closestInArea=function(){return T.closest(T.ar)},T.defaults=function(t){return _.first($(t||D()))},T.defaultsInArea=function(){return T.defaults(T.ar)},T.hovered=function(){var t=_.flatten(_.map(I(),$));return B(T.pos,t)},T.circular=function(t){var n,e=x(T.ar).center();return n=t?p(x(T.el).bound(w[t]),e,w[t]):h(T.pos,e),O(n,$(T.ar),t)},T.block=function(){z=!0,i(T.el,"blocked")},T.unblock=function(){z=!1,u(T.el,"blocked")},T.clear=_.once(function(){Z(),T.pos=a(),T.el=null,T.ar=null,t=null,z=!1,J=null}),T.update=function(){T.focus(T.closest())},T.init=function(){if(N)throw new Error("mickey: already initialized");return R(),T.focus(f.position?T.hovered():T.defaults()),T};var F=function(){if(!N)return T.init();if(t&&!t.contains(T.el)){var n,e=T.ar;switch(e.dataset.navPolicy){default:case"closest":n=T.closestInArea();break;case"defaults":n=T.defaultsInArea();break;case"hovered":n=T.hovered();break;case"circular":n=T.circular()}T.focus(n,null,!0)}};return T}var w={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},g={37:"left",38:"up",39:"right",40:"down",13:"click"},M={left:"left",up:"top",right:"right",down:"bottom"},E={left:"horizontal",right:"horizontal",up:"vertical",down:"vertical"},C=b("navLimit",1),L=b("navSelected",-1);k.prototype.contains=function(t){var n=this.center(),e=c(n,this.bound(w.down)),r=c(n,this.bound(w.right)),o=c(n,t);return 2*Math.abs(v(e,o))<=this._r.height&&2*Math.abs(v(r,o))<=this._r.width},k.prototype.center=function(){return{x:this._r.left+this._r.width/2,y:this._r.top+this._r.height/2}},k.prototype.bound=function(t){return{x:this._r.left+this._r.width*(1+t.x)/2,y:this._r.top+this._r.height*(1+t.y)/2}},t.exports=m}])});